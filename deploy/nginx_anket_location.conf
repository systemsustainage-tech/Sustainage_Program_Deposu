# Sustainage Anket Modülü Nginx Konfigürasyonu
# Bu blok, ana server bloğu içine (/etc/nginx/sites-available/sustainage) eklenecektir.

location /anket {
    alias /var/www/sustainage/anket;
    index index.php index.html;
    try_files $uri $uri/ /anket/index.php?$query_string;

    # PHP Dosyalarını İşleme
    location ~ \.php$ {
        include snippets/fastcgi-php.conf;
        
        # PHP-FPM soketi (Ubuntu varsayılanı)
        # Versiyona göre değişebilir: php7.4-fpm, php8.1-fpm vb.
        fastcgi_pass unix:/var/run/php/php8.1-fpm.sock;
        
        fastcgi_param SCRIPT_FILENAME $request_filename;
        include fastcgi_params;
        
        # Timeout ayarları (uzun süren işlemler için)
        fastcgi_read_timeout 300;
    }

    # Statik Dosyalar
    location ~* \.(css|js|jpg|jpeg|png|gif|ico|svg|webp)$ {
        expires 30d;
        add_header Cache-Control "public, no-transform";
    }

    # Güvenlik: . dosyaları ve SQL dosyalarını engelle
    location ~ /\.(?!well-known).* {
        deny all;
    }
    location ~ \.sql$ {
        deny all;
    }
    location ~ \.sqlite$ {
        deny all;
    }
}
