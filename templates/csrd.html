{% extends "base.html" %}

{% block title %}{{ lang('csrd_title') }} - SDG Platform{% endblock %}

{% block content %}

<div class="row mb-4">
<div class="col-md-12">
<div class="d-flex justify-content-between align-items-center">
<h1><i class="fas fa-book-reader me-2"></i>{{ lang('csrd_title') }}</h1>
<div>
<span class="badge bg-{{ 'success' if manager_available else 'danger' }}">
                    {{ lang('module_active_badge') if manager_available else _('module_passive_badge') }}
                </span>
<button class="btn btn-sm btn-outline-secondary ms-2" onclick="history.back()"><i class="bi bi-arrow-left"></i> {{ lang('btn_back', 'Geri') }}</button></div>
</div>
<p class="lead text-muted">{{ lang('csrd_desc') }}</p>
</div>
</div>

{% if manager_available %}
<div class="row">
<div class="col-md-4 mb-4">
<div class="list-group">
<a aria-current="true" class="list-group-item list-group-item-action active" href="#">
<div class="d-flex w-100 justify-content-between">
<h5 class="mb-1">{{ lang('csrd_esrs_general') }}</h5>
</div>
<p class="mb-1">{{ lang('csrd_esrs_general_desc') }}</p>
</a>
<a class="list-group-item list-group-item-action" href="#">
<div class="d-flex w-100 justify-content-between">
<h5 class="mb-1">{{ lang('csrd_esrs_env') }}</h5>
</div>
<p class="mb-1">{{ lang('csrd_esrs_env_desc') }}</p>
</a>
<a class="list-group-item list-group-item-action" href="#">
<div class="d-flex w-100 justify-content-between">
<h5 class="mb-1">{{ lang('csrd_esrs_social') }}</h5>
</div>
<p class="mb-1">{{ lang('csrd_esrs_social_desc') }}</p>
</a>
<a class="list-group-item list-group-item-action" href="#">
<div class="d-flex w-100 justify-content-between">
<h5 class="mb-1">{{ lang('csrd_esrs_gov') }}</h5>
</div>
<p class="mb-1">{{ lang('csrd_esrs_gov_desc') }}</p>
</a>
</div>
</div>
<div class="col-md-8">
<div class="card mb-4">
<div class="card-header">
                {{ lang('csrd_materiality_title') }} (Double Materiality)
            </div>
<div class="card-body">
<p>{{ lang('csrd_materiality_desc') }}</p>
<a class="btn btn-primary" href="{{ url_for('csrd_materiality') }}">{{ lang('btn_start_analysis') }}</a>
</div>
</div>

        {% if materiality %}
        <div class="card">
<div class="card-header">
                {{ lang('csrd_matrix') }}
            </div>
<div class="card-body">
<div class="table-responsive">
<table class="table">
<thead>
<tr>
<th>{{ lang('csrd_topic') }}</th>
<th>{{ lang('csrd_impact_score') }}</th>
<th>{{ lang('csrd_financial_score') }}</th>
<th>{{ lang('csrd_rationale') }}</th>
</tr>
</thead>
<tbody>
                            {% for item in materiality %}
                            <tr>
<td><span class="badge bg-secondary">{{ item.topic_code }}</span> {{ item.topic_name }}</td>
<td>
                                    {% if item.impact_score >= 4 %}
                                        <span class="badge bg-danger">{{ item.impact_score }}</span>
                                    {% else %}
                                        <span class="badge bg-success">{{ item.impact_score }}</span>
                                    {% endif %}
                                </td>
<td>
                                    {% if item.financial_score >= 4 %}
                                        <span class="badge bg-danger">{{ item.financial_score }}</span>
                                    {% else %}
                                        <span class="badge bg-success">{{ item.financial_score }}</span>
                                    {% endif %}
                                </td>
<td><small>{{ item.rationale }}</small></td>
</tr>
                            {% endfor %}
                        </tbody>
</table>
</div>
</div>
</div>
        {% endif %}
    </div>
</div>
{% else %}
<div class="alert alert-warning">
<h4 class="alert-heading">{{ lang('module_failed_title') }}</h4>
<p>{{ lang('module_failed_desc') }}</p>
</div>
{% endif %}
{% endblock %}
