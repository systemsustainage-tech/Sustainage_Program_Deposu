{% extends "base.html" %}

{% block title %}{{ lang('roles_page_title', 'Rol Yönetimi') }}{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.btn-delete-role');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function(e) {
                const msg = this.getAttribute('data-confirm-message');
                if (!confirm(msg)) {
                    e.preventDefault();
                }
            });
        });
    });
</script>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">{{ lang('roles_header', 'Rol Yönetimi') }}</h1>
    <div class="btn-toolbar mb-2 mb-md-0">
        {% if session.role|lower in ['admin', 'super_admin'] %}
        <a class="btn btn-sm btn-primary" href="{{ url_for('role_add') }}">
            <i class="bi bi-plus-circle"></i> {{ lang('roles_new_role', 'Yeni Rol Ekle') }}
        </a>
        {% endif %}
        <button class="btn btn-sm btn-outline-secondary ms-2" onclick="history.back()">
            <i class="bi bi-arrow-left"></i> {{ lang('btn_back', 'Geri') }}
        </button>
    </div>
</div>

<div class="table-responsive shadow-sm rounded">
    <table class="table table-striped table-hover align-middle mb-0 bg-white">
        <thead class="table-light">
            <tr>
                <th>{{ lang('col_id', 'ID') }}</th>
                <th>{{ lang('col_role_name', 'Rol Adı') }}</th>
                <th>{{ lang('col_description', 'Açıklama') }}</th>
                <th>{{ lang('col_type', 'Tip') }}</th>
                <th>{{ lang('col_status', 'Durum') }}</th>
                <th class="text-end">{{ lang('col_actions', 'İşlemler') }}</th>
            </tr>
        </thead>
        <tbody>
            {% for role in roles %}
            <tr>
                <td>{{ role.id }}</td>
                <td>
                    <div class="fw-bold">{{ role.display_name }}</div>
                    <div class="text-muted small">{{ role.name }}</div>
                </td>
                <td>{{ role.description }}</td>
                <td>
                    {% if role.is_system_role %}
                    <span class="badge bg-dark">{{ lang('role_system', 'Sistem') }}</span>
                    {% else %}
                    <span class="badge bg-info text-dark">{{ lang('role_custom', 'Özel') }}</span>
                    {% endif %}
                </td>
                <td>
                    {% if role.is_active %}
                    <span class="badge bg-success">{{ lang('status_active', 'Aktif') }}</span>
                    {% else %}
                    <span class="badge bg-secondary">{{ lang('status_passive', 'Pasif') }}</span>
                    {% endif %}
                </td>
                <td class="text-end">
                    {% if session.role|lower in ['admin', 'super_admin'] %}
                    <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('role_edit', role_id=role.id) }}" title="{{ lang('common_edit', 'Düzenle') }}">
                        <i class="bi bi-pencil"></i>
                    </a>
                    {% if not role.is_system_role %}
                    <a class="btn btn-sm btn-outline-danger btn-delete-role" href="{{ url_for('role_delete', role_id=role.id) }}" data-confirm-message="{{ lang('roles_confirm_delete', 'Bu rolü silmek istediğinize emin misiniz?') }}" title="{{ lang('common_delete', 'Sil') }}">
                        <i class="bi bi-trash"></i>
                    </a>
                    {% endif %}
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td class="text-center py-4" colspan="6">{{ lang('roles_no_records', 'Kayıtlı rol bulunamadı.') }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
