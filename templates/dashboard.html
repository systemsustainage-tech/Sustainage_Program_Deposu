{% extends "base.html" %}

{% block title %}Dashboard - SDG{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-12">
        <div class="card shadow-sm border-0">
            <div class="card-body d-flex justify-content-between align-items-center">
                <div>
                    <h2 class="mb-0">{{ lang('dashboard_welcome') }}, <span class="text-primary">{{ session.user }}</span></h2>
                    <p class="text-muted mb-0">
                        <i class="bi bi-shield-lock-fill"></i> {{ lang('dashboard_role') }}: {{ session.get('role', 'Kullanıcı') }}
                    </p>
                </div>
                <div class="btn-toolbar gap-2">
                    <span class="badge bg-success rounded-pill p-2">
                        <i class="bi bi-wifi"></i> {{ lang('system_online') }}
                    </span>
                    <button class="btn btn-sm btn-outline-secondary" onclick="history.back()">
                        <i class="bi bi-arrow-left"></i> {{ lang('btn_back', 'Geri') }}
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Hızlı Erişim Menüsü Kaldırıldı -->
<!--
<div class="row mb-4">
</div>
-->

<!-- Özet İstatistikler
<div class="row g-4 mb-4">
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm text-center">
            <div class="card-body">
                <div class="display-4 text-primary mb-2"><i class="bi bi-people-fill"></i></div>
                <h5 class="card-title">{{ lang('users_title') }}</h5>
                <h2 class="fw-bold">{{ stats.user_count if stats.user_count is not none else '-' }}</h2>
                <a href="{{ url_for('users') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm text-center">
            <div class="card-body">
                <div class="display-4 text-success mb-2"><i class="bi bi-building"></i></div>
                <h5 class="card-title">{{ lang('companies_title') }}</h5>
                <h2 class="fw-bold">{{ stats.company_count }}</h2>
                <a href="{{ url_for('companies') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm text-center">
            <div class="card-body">
                <div class="display-4 text-info mb-2"><i class="bi bi-file-earmark-text-fill"></i></div>
                <h5 class="card-title">{{ lang('reports_title') }}</h5>
                <h2 class="fw-bold">{{ stats.report_count }}</h2>
                <a href="{{ url_for('reports') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
</div>
-->

<!-- Anket İstatistikleri -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm text-center">
            <div class="card-body">
                <i class="bi bi-clipboard-data fs-1 text-primary mb-2"></i>
                <h5 class="card-title">{{ lang('active_surveys') }}</h5>
                <h2 class="fw-bold">{{ stats.active_surveys }}</h2>
                <a href="{{ url_for('surveys_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card h-100 border-0 shadow-sm text-center">
            <div class="card-body">
                <i class="bi bi-chat-left-text fs-1 text-success mb-2"></i>
                <h5 class="card-title">{{ lang('total_responses', 'Toplam Cevap') }}</h5>
                <h2 class="fw-bold">{{ stats.total_responses }}</h2>
                <a href="{{ url_for('surveys_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
</div>

<!-- Widgets: Recent Activities & Pending Actions -->
<div class="row mb-4">
    <!-- Recent Activities -->
    <div class="col-lg-8 mb-3">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-header bg-white border-0 py-3 d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0"><i class="bi bi-clock-history text-primary me-2"></i>{{ lang('recent_activities', 'Son Aktiviteler') }}</h5>
                <button class="btn btn-sm btn-outline-secondary" type="button" data-bs-toggle="collapse" data-bs-target="#activityFilters" aria-expanded="false" aria-controls="activityFilters">
                    <i class="bi bi-filter"></i> {{ lang('filter', 'Filtrele') }}
                </button>
            </div>
            <div class="collapse {% if start_date or end_date or module_filter %}show{% endif %}" id="activityFilters">
                <div class="card-body bg-light border-bottom">
                    <form action="{{ url_for('dashboard') }}" method="get" class="row g-2 align-items-end">
                        <div class="col-md-3">
                            <label class="form-label small text-muted mb-1">{{ lang('start_date', 'Başlangıç') }}</label>
                            <input type="date" class="form-control form-control-sm" name="start_date" value="{{ start_date }}">
                        </div>
                        <div class="col-md-3">
                            <label class="form-label small text-muted mb-1">{{ lang('end_date', 'Bitiş') }}</label>
                            <input type="date" class="form-control form-control-sm" name="end_date" value="{{ end_date }}">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label small text-muted mb-1">{{ lang('module_action', 'Modül / İşlem') }}</label>
                            <input type="text" class="form-control form-control-sm" name="module" value="{{ module_filter or '' }}" placeholder="{{ lang('search_placeholder', 'Ara...') }}">
                        </div>
                        <div class="col-md-2">
                            <button type="submit" class="btn btn-sm btn-primary w-100"><i class="bi bi-search"></i></button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover align-middle mb-0 no-datatable">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" class="ps-4">{{ lang('user', 'Kullanıcı') }}</th>
                                <th scope="col">{{ lang('action', 'İşlem') }}</th>
                                <th scope="col">{{ lang('date', 'Tarih') }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% if recent_activities %}
                                {% for activity in recent_activities %}
                                <tr>
                                    <td class="ps-4">
                                        <div class="d-flex align-items-center">
                                            <div class="rounded-circle bg-light text-primary d-flex align-items-center justify-content-center me-2" style="width: 35px; height: 35px; font-weight: bold;">
                                                {{ activity.username[0] | upper if activity.username else '?' }}
                                            </div>
                                            <span class="fw-bold text-dark">{{ activity.username }}</span>
                                        </div>
                                    </td>
                                    <td>
                                        <span class="badge bg-light text-dark border">{{ activity.action }}</span>
                                        <small class="text-muted d-block mt-1">{{ activity.details }}</small>
                                    </td>
                                    <td class="text-muted small">{{ activity.timestamp }}</td>
                                </tr>
                                {% endfor %}
                            {% else %}
                            <tr>
                                <td colspan="3" class="text-center py-4 text-muted">
                                    {{ lang('no_recent_activity', 'Henüz aktivite yok.') }}
                                </td>
                            </tr>
                            {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Pending Actions -->
    <div class="col-lg-4 mb-3">
        <div class="card h-100 shadow-sm border-0">
            <div class="card-header bg-white border-0 py-3">
                <h5 class="card-title mb-0"><i class="bi bi-exclamation-circle text-warning me-2"></i>{{ lang('pending_actions', 'Bekleyen İşler') }}</h5>
            </div>
            <div class="card-body">
                {% if pending_actions %}
                <div class="list-group list-group-flush">
                    {% for action in pending_actions %}
                    <a href="{{ action.link }}" class="list-group-item list-group-item-action d-flex align-items-center p-3 border-0 mb-2 rounded bg-light" style="transition: all 0.2s;">
                        <div class="rounded bg-{{ action.type }} text-white d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px; min-width: 40px;">
                            <i class="bi bi-bell-fill"></i>
                        </div>
                        <div class="flex-fill">
                            <h6 class="mb-0 fw-bold text-dark">{{ action.title }}</h6>
                            <small class="text-muted">{{ action.desc }}</small>
                        </div>
                        <i class="bi bi-chevron-right text-muted"></i>
                    </a>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-5">
                    <i class="bi bi-check-circle fs-1 text-success mb-3"></i>
                    <p class="text-muted">{{ lang('all_caught_up', 'Harika! Bekleyen işiniz yok.') }}</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- SÜRDÜRÜLEBİLİRLİK MODÜLLERİ (19 MODÜL) -->
<div class="row mb-4" id="modules-section">
    <div class="col-12 mb-3">
        <h4 class="text-muted border-bottom pb-2"><i class="bi bi-grid-fill me-2"></i>{{ lang('sustainability_modules', 'Sürdürülebilirlik Modülleri') }}</h4>
    </div>
    
    <!-- Çevresel (Environmental) -->
    <div class="col-12"><h6 class="text-success mb-3">{{ lang('module_environmental', 'Çevresel') }}</h6></div>
    
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-cloud-haze2 fs-1 text-success mb-2"></i>
                <h6 class="card-title">{{ lang('module_carbon', 'Karbon Ayak İzi') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('carbon', 0) }}" aria-valuenow="{{ module_stats.get('carbon', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('carbon', 0) }}</small>
                <a href="{{ url_for('carbon_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-lightning-charge fs-1 text-warning mb-2"></i>
                <h6 class="card-title">{{ lang('module_energy', 'Enerji Yönetimi') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('energy', 0) }}" aria-valuenow="{{ module_stats.get('energy', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('energy', 0) }}</small>
                <a href="{{ url_for('energy_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-recycle fs-1 text-secondary mb-2"></i>
                <h6 class="card-title">{{ lang('module_waste', 'Atık Yönetimi') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('waste', 0) }}" aria-valuenow="{{ module_stats.get('waste', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('waste', 0) }}</small>
                <a href="{{ url_for('waste_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-droplet fs-1 text-info mb-2"></i>
                <h6 class="card-title">{{ lang('module_water', 'Su Yönetimi') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('water', 0) }}" aria-valuenow="{{ module_stats.get('water', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('water', 0) }}</small>
                <a href="{{ url_for('water_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-tree fs-1 text-success mb-2"></i>
                <h6 class="card-title">{{ lang('module_biodiversity', 'Biyoçeşitlilik') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('biodiversity', 0) }}" aria-valuenow="{{ module_stats.get('biodiversity', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('biodiversity', 0) }}</small>
                <a href="{{ url_for('biodiversity_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>

    <!-- Sosyal & Yönetişim (Social & Governance) -->
    <div class="col-12 mt-3"><h6 class="text-primary mb-3">{{ lang('module_social_governance', 'Sosyal & Yönetişim') }}</h6></div>
    
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-people fs-1 text-info mb-2"></i>
                <h6 class="card-title">{{ lang('module_social_impact', 'Sosyal Etki') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('social', 0) }}" aria-valuenow="{{ module_stats.get('social', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('social', 0) }}</small>
                <a href="{{ url_for('social_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-bank fs-1 text-secondary mb-2"></i>
                <h6 class="card-title">{{ lang('module_corporate_governance', 'Kurumsal Yönetişim') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('governance', 0) }}" aria-valuenow="{{ module_stats.get('governance', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('governance', 0) }}</small>
                <a href="{{ url_for('governance_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-truck fs-1 text-warning mb-2"></i>
                <h6 class="card-title">{{ lang('module_supply_chain', 'Tedarik Zinciri') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('supply_chain', 0) }}" aria-valuenow="{{ module_stats.get('supply_chain', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('supply_chain', 0) }}</small>
                <a href="{{ url_for('supply_chain_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-cash-coin fs-1 text-success mb-2"></i>
                <h6 class="card-title">{{ lang('module_economic_value', 'Ekonomik Değer') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('economic', 0) }}" aria-valuenow="{{ module_stats.get('economic', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('economic', 0) }}</small>
                <a href="{{ url_for('economic_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>

    <!-- Çerçeveler & Standartlar (Frameworks & Standards) -->
    <div class="col-12 mt-3"><h6 class="text-danger mb-3">{{ lang('module_frameworks', 'Çerçeveler & Standartlar') }}</h6></div>
    
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-bar-chart-steps fs-1 text-primary mb-2"></i>
                <h6 class="card-title">{{ lang('module_esg_score', 'ESG Skoru') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('esg', 0) }}" aria-valuenow="{{ module_stats.get('esg', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('esg', 0) }}</small>
                <a href="{{ url_for('esg_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-globe-europe-africa fs-1 text-danger mb-2"></i>
                <h6 class="card-title">{{ lang('module_cbam', 'CBAM') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('cbam', 0) }}" aria-valuenow="{{ module_stats.get('cbam', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('cbam', 0) }}</small>
                <a href="{{ url_for('cbam_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-file-earmark-check fs-1 text-primary mb-2"></i>
                <h6 class="card-title">{{ lang('module_csrd', 'CSRD') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('csrd', 0) }}" aria-valuenow="{{ module_stats.get('csrd', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('csrd', 0) }}</small>
                <a href="{{ url_for('csrd_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-diagram-3 fs-1 text-success mb-2"></i>
                <h6 class="card-title">{{ lang('module_eu_taxonomy', 'AB Taksonomisi') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('taxonomy', 0) }}" aria-valuenow="{{ module_stats.get('taxonomy', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('taxonomy', 0) }}</small>
                <a href="{{ url_for('taxonomy_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-journal-text fs-1 text-info mb-2"></i>
                <h6 class="card-title">{{ lang('module_gri', 'GRI') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('gri', 0) }}" aria-valuenow="{{ module_stats.get('gri', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('gri', 0) }}</small>
                <a href="{{ url_for('gri_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-bullseye fs-1 text-danger mb-2"></i>
                <h6 class="card-title">{{ lang('module_sdg', 'SDG') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('sdg', 0) }}" aria-valuenow="{{ module_stats.get('sdg', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('sdg', 0) }}</small>
                <a href="{{ url_for('sdg_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-file-earmark-richtext fs-1 text-primary mb-2"></i>
                <h6 class="card-title">{{ lang('module_esrs', 'ESRS') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('esrs', 0) }}" aria-valuenow="{{ module_stats.get('esrs', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('esrs', 0) }}</small>
                <a href="{{ url_for('esrs_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    
    <!-- İleri Raporlama (Advanced Reporting) -->
    <div class="col-12 mt-3"><h6 class="text-secondary mb-3">{{ lang('module_advanced_reporting', 'İleri Raporlama') }}</h6></div>
    
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-sort-numeric-down fs-1 text-warning mb-2"></i>
                <h6 class="card-title">{{ lang('module_prioritization', 'Önceliklendirme') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('prioritization', 0) }}" aria-valuenow="{{ module_stats.get('prioritization', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('prioritization', 0) }}</small>
                <a href="{{ url_for('prioritization_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-file-earmark-spreadsheet fs-1 text-primary mb-2"></i>
                <h6 class="card-title">{{ lang('module_ifrs', 'IFRS') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('ifrs', 0) }}" aria-valuenow="{{ module_stats.get('ifrs', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('ifrs', 0) }}</small>
                <a href="{{ url_for('ifrs_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-cloud-sun fs-1 text-warning mb-2"></i>
                <h6 class="card-title">{{ lang('module_tcfd', 'TCFD') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('tcfd', 0) }}" aria-valuenow="{{ module_stats.get('tcfd', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('tcfd', 0) }}</small>
                <a href="{{ url_for('tcfd_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-flower1 fs-1 text-success mb-2"></i>
                <h6 class="card-title">{{ lang('module_tnfd', 'TNFD') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('tnfd', 0) }}" aria-valuenow="{{ module_stats.get('tnfd', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('tnfd', 0) }}</small>
                <a href="{{ url_for('tnfd_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
    <div class="col-md-2 mb-3">
        <div class="card h-100 text-center border-0 shadow-sm hover-card">
            <div class="card-body">
                <i class="bi bi-building-check fs-1 text-dark mb-2"></i>
                <h6 class="card-title">{{ lang('module_cdp', 'CDP') }}</h6>
                <div class="progress mt-2 mb-1" style="height: 5px;">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ module_stats.get('cdp', 0) }}" aria-valuenow="{{ module_stats.get('cdp', 0) }}" aria-valuemin="0" aria-valuemax="100"></div>
                </div>
                <small class="text-muted">%{{ module_stats.get('cdp', 0) }}</small>
                <a href="{{ url_for('cdp_module') }}" class="stretched-link"></a>
            </div>
        </div>
    </div>
</div>

<!-- Grafikler (Demo) -->
<div class="row mb-4">
    <!-- Önceliklendirme Matrisi Özeti -->
    <div class="col-md-4 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0">
                <h5 class="mb-0"><i class="bi bi-list-ol"></i> {{ lang('top_material_topics') }}</h5>
            </div>
            <div class="card-body">
                {% if top_material_topics %}
                <ul class="list-group list-group-flush">
                    {% for topic in top_material_topics %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        {{ topic.topic_name }}
                        <span class="badge bg-primary rounded-pill">{{ topic.priority_score | round(1) }}</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted text-center py-3">{{ lang('no_material_topics') }}</p>
                {% endif %}
                <div class="text-center mt-3">
                    <a href="{{ url_for('prioritization_module') }}" class="btn btn-sm btn-outline-primary">{{ lang('view_details') }}</a>
                </div>
            </div>
        </div>
    </div>

    <!-- ESRS Durumu -->
    <div class="col-md-4 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0">
                <h5 class="mb-0"><i class="bi bi-check-circle"></i> {{ lang('esrs_status') }}</h5>
            </div>
            <div class="card-body">
                <div class="d-flex align-items-center justify-content-center h-100 flex-column">
                    <h3 class="display-6 fw-bold text-success">{{ esrs_stats.completion_rate }}%</h3>
                    <p class="text-muted">{{ lang('completion_rate') }}</p>
                    <div class="progress w-75 mt-2" style="height: 10px;">
                        <div class="progress-bar bg-success" role="progressbar" style="width: 0%" data-width="{{ esrs_stats.completion_rate }}" aria-valuenow="{{ esrs_stats.completion_rate }}" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                    <div class="text-center mt-4">
                        <a href="{{ url_for('esrs_module') }}" class="btn btn-sm btn-outline-success">{{ lang('view_details') }}</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emisyon Dağılımı -->
    <div class="col-md-4 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0">
                <h5 class="mb-0"><i class="bi bi-pie-chart-fill"></i> {{ lang('chart_emission_dist') }}</h5>
            </div>
            <div class="card-body">
                <canvas id="emissionsChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- ISO 26000 Sosyal Performans -->
<div class="row mb-4">
    <div class="col-md-6 mb-3">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0">
                <h5 class="mb-0"><i class="bi bi-people"></i> {{ lang('social_performance', 'Sosyal Performans (ISO 26000)') }}</h5>
            </div>
            <div class="card-body">
                <canvas id="socialPerformanceChart"></canvas>
            </div>
        </div>
    </div>
</div>

<!-- Trend Grafiği -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card shadow-sm border-0 h-100">
            <div class="card-header bg-white border-0">
                <h5 class="mb-0"><i class="bi bi-graph-up"></i> {{ lang('chart_emission_trend') }}</h5>
            </div>
            <div class="card-body">
                <canvas id="trendChart" height="80"></canvas>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script nonce="{{ csp_nonce() }}">
document.addEventListener("DOMContentLoaded", function() {
    // Check if Chart.js is loaded
    if (typeof Chart === 'undefined') {
        console.error('Chart.js library is not loaded!');
        document.querySelectorAll('canvas').forEach(canvas => {
            canvas.parentElement.innerHTML = '<div class="alert alert-danger">Grafik kütüphanesi yüklenemedi.</div>';
        });
        return;
    }

    // Data Definitions - Safe handling of server-side data
    const socialData = {{ social_chart_data | tojson | safe }} || [0,0,0,0,0];
    const emissionData = {{ emission_trend_data | tojson | safe }} || Array(12).fill(0);

    // 1. Emissions Chart (Doughnut)
    const emissionsCanvas = document.getElementById('emissionsChart');
    if (emissionsCanvas) {
        new Chart(emissionsCanvas.getContext('2d'), {
            type: 'doughnut',
            data: {
                labels: ["{{ lang('scope_1') }}", "{{ lang('scope_2') }}", "{{ lang('scope_3') }}"],
                datasets: [{
                    data: [30, 45, 25], // Placeholder data - should be dynamic in future
                    backgroundColor: ['#ff6384', '#36a2eb', '#ffce56']
                }]
            }
        });
    }

    // 2. Social Performance Chart (Radar)
    const socialCanvas = document.getElementById('socialPerformanceChart');
    if (socialCanvas) {
        new Chart(socialCanvas.getContext('2d'), {
            type: 'radar',
            data: {
                labels: [
                    "{{ lang('satisfaction', 'Memnuniyet') }}", 
                    "{{ lang('training', 'Eğitim') }}", 
                    "{{ lang('ohs', 'İSG') }}", 
                    "{{ lang('human_rights', 'İnsan Hakları') }}", 
                    "{{ lang('fair_labor', 'Adil Çalışma') }}"
                ],
                datasets: [{
                    label: "{{ lang('social_score', 'Sosyal Skor') }}",
                    data: socialData,
                    fill: true,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)',
                    borderColor: 'rgb(54, 162, 235)',
                    pointBackgroundColor: 'rgb(54, 162, 235)',
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: 'rgb(54, 162, 235)'
                }]
            },
            options: {
                elements: { line: { borderWidth: 3 } },
                scales: {
                    r: {
                        angleLines: { display: true },
                        suggestedMin: 0,
                        suggestedMax: 100
                    }
                }
            }
        });
    }

    // 3. Trend Chart (Line)
    const trendCanvas = document.getElementById('trendChart');
    if (trendCanvas) {
        new Chart(trendCanvas.getContext('2d'), {
            type: 'line',
            data: {
                labels: ["{{ lang('month_jan') }}", "{{ lang('month_feb') }}", "{{ lang('month_mar') }}", "{{ lang('month_apr') }}", "{{ lang('month_may') }}", "{{ lang('month_jun') }}", "{{ lang('month_jul') }}", "{{ lang('month_aug') }}", "{{ lang('month_sep') }}", "{{ lang('month_oct') }}", "{{ lang('month_nov') }}", "{{ lang('month_dec') }}"],
                datasets: [{
                    label: "{{ lang('emission_tco2e') }}",
                    data: emissionData,
                    borderColor: '#4bc0c0',
                    fill: false
                }]
            }
        });
    }

    // Progress Bar Animation
    const progressBars = document.querySelectorAll('.progress-bar[data-width]');
    progressBars.forEach(bar => {
        const width = bar.getAttribute('data-width');
        setTimeout(() => {
            bar.style.width = width + '%';
            bar.setAttribute('aria-valuenow', width);
        }, 300);
    });
});
</script>

{% endblock %}
