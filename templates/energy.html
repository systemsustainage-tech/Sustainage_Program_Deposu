{% extends "base.html" %}

{% block title %}{{ lang('energy_title') }} - SDG Platform{% endblock %}

{% block content %}

<div class="row mb-4">
<div class="col-md-12">
<div class="d-flex justify-content-between align-items-center">
<h1><i class="fas fa-bolt me-2"></i>{{ lang('energy_title') }}</h1>
<div>
<span class="badge bg-{{ 'success' if manager_available else 'danger' }}">
                    {{ lang('module_active') if manager_available else _('module_passive') }}
                </span>
<button class="btn btn-sm btn-outline-secondary ms-2" onclick="history.back()"><i class="bi bi-arrow-left"></i> {{ lang('btn_back', 'Geri') }}</button></div>
</div>
<p class="lead text-muted">{{ lang('energy_desc') }}</p>
</div>
</div>

{% if manager_available %}
<!-- Stats Overview -->
<div class="row mb-4">
<div class="col-md-6 mb-4">
<div class="card bg-light border-0 h-100">
<div class="card-body">
<h5 class="card-title text-muted mb-0">{{ lang('total_consumption') }}</h5>
<h2 class="display-4 fw-bold text-dark mb-0">{{ "{:,.2f}".format(stats.total_consumption) }} <span class="fs-4 text-muted">kWh</span></h2>
<button class="btn btn-primary mt-3" data-bs-target="#addEnergyModal" data-bs-toggle="modal" type="button">
<i class="bi bi-plus-lg"></i> {{ lang('add_new', 'Yeni Ekle') }}
                </button>
</div>
</div>
</div>
<div class="col-md-6 mb-4">
<div class="card bg-light border-0 h-100">
<div class="card-body">
<h5 class="card-title text-muted mb-0">{{ lang('total_cost') }}</h5>
<h2 class="display-4 fw-bold text-success mb-0">{{ "{:,.2f}".format(stats.total_cost) }} <span class="fs-4 text-muted">TL</span></h2>
<div class="mt-3 text-muted">
                    {{ lang('renewable_ratio') }}: <strong>%{{ "{:,.1f}".format(stats.renewable_ratio) }}</strong>
</div>
</div>
</div>
</div>
</div>
<div class="row">
<div class="col-md-6 mb-4">
<div class="card h-100 border-0 shadow-sm">
<div class="card-body">
<h5 class="card-title">{{ lang('energy_consumption_title') }}</h5>
<p class="card-text text-muted">{{ lang('energy_consumption_desc') }}</p>
<button class="btn btn-outline-primary w-100" data-bs-target="#addEnergyModal" data-bs-toggle="modal" type="button">
                    {{ lang('btn_production_data') }}
                </button>
</div>
</div>
</div>
<div class="col-md-6 mb-4">
<div class="card h-100 border-0 shadow-sm">
<div class="card-body">
<h5 class="card-title">{{ lang('energy_renewable_title') }}</h5>
<p class="card-text text-muted">{{ lang('energy_renewable_desc') }}</p>
<button class="btn btn-outline-success w-100" data-bs-target="#addEnergyModal" data-bs-toggle="modal" onclick="document.getElementById('source').value='solar'" type="button">
                    {{ lang('btn_add_data') }}
                </button>
</div>
</div>
</div>
</div>
<!-- Recent Data Table -->
<div class="row mt-4">
<div class="col-12">
<div class="card shadow-sm border-0">
<div class="card-header bg-transparent border-0 d-flex justify-content-between align-items-center">
<h5 class="mb-0">{{ lang('recent_energy_records') }}</h5>
</div>
<div class="table-responsive">
<table class="table table-hover align-middle mb-0">
<thead class="table-light">
<tr>
<th>{{ lang('table_period') }}</th>
<th>{{ lang('table_energy_type') }}</th>
<th>{{ lang('table_consumption') }}</th>
<th>{{ lang('table_unit') }}</th>
<th>{{ lang('table_cost') }}</th>
<th>{{ lang('table_date') }}</th>
</tr>
</thead>
<tbody>
                        {% for row in recent_data %}
                        <tr>
<td>{{ row['year'] }}-{{ row['month'] }}</td>
<td><span class="badge bg-info text-dark">{{ row['type'] }}</span></td>
<td class="fw-bold">{{ row['amount'] }}</td>
<td>{{ row['unit'] }}</td>
<td>{{ row['cost'] }} TL</td>
<td class="text-muted small">{{ row['date'][:10] if row['date'] else '' }}</td>
</tr>
                        {% else %}
                        <tr>
<td class="text-center py-4 text-muted" colspan="6">{{ lang('no_data_yet') }}</td>
</tr>
                        {% endfor %}
                    </tbody>
</table>
</div>
</div>
</div>
</div>

{% else %}
<div class="alert alert-warning">
<h4 class="alert-heading">{{ lang('module_load_error') }}</h4>
<p>{{ lang('module_energy_unavailable') }}</p>
</div>
{% endif %}

<!-- Add Energy Modal -->
<div aria-hidden="true" class="modal fade" id="addEnergyModal" tabindex="-1">
<div class="modal-dialog">
<div class="modal-content">
<div class="modal-header">
<h5 class="modal-title">{{ lang('add_new_energy', 'Yeni Enerji Tüketimi Ekle') }}</h5>
<button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
</div>
<form action="{{ url_for('data_add') }}" method="POST">
<input name="data_type" type="hidden" value="energy"/>
<div class="modal-body">
<div class="mb-3">
<label class="form-label" for="energy_type">{{ lang('energy_type', 'Enerji Türü') }}</label>
<select class="form-select" id="energy_type" name="energy_type" required="">
<option value="electricity">{{ lang('electricity', 'Elektrik') }}</option>
<option value="natural_gas">{{ lang('natural_gas', 'Doğalgaz') }}</option>
<option value="diesel">{{ lang('diesel', 'Dizel') }}</option>
<option value="gasoline">{{ lang('gasoline', 'Benzin') }}</option>
<option value="coal">{{ lang('coal', 'Kömür') }}</option>
<option value="lpg">{{ lang('lpg', 'LPG') }}</option>
</select>
</div>
<div class="mb-3">
<label class="form-label" for="source">{{ lang('energy_source', 'Enerji Kaynağı') }}</label>
<select class="form-select" id="source" name="source" required="">
<option value="grid">{{ lang('grid', 'Şebeke') }}</option>
<option value="solar">{{ lang('solar', 'Güneş') }}</option>
<option value="wind">{{ lang('wind', 'Rüzgar') }}</option>
<option value="hydro">{{ lang('hydro', 'Hidroelektrik') }}</option>
<option value="biomass">{{ lang('biomass', 'Biyokütle') }}</option>
<option value="generator">{{ lang('generator', 'Jeneratör') }}</option>
</select>
</div>
<div class="row">
<div class="col-md-6 mb-3">
<label class="form-label" for="amount">{{ lang('amount', 'Miktar') }}</label>
<input class="form-control" id="amount" name="amount" required="" step="0.01" type="number"/>
</div>
<div class="col-md-6 mb-3">
<label class="form-label" for="unit">{{ lang('unit', 'Birim') }}</label>
<select class="form-select" id="unit" name="unit" required="">
<option value="kWh">kWh</option>
<option value="MWh">MWh</option>
<option value="m3">m3</option>
<option value="liter">Litre</option>
<option value="kg">kg</option>
<option value="ton">ton</option>
</select>
</div>
</div>
<div class="mb-3">
<label class="form-label" for="cost">{{ lang('cost', 'Maliyet (TL)') }}</label>
<input class="form-control" id="cost" name="cost" step="0.01" type="number"/>
</div>
<div class="mb-3">
<label class="form-label" for="date">{{ lang('date', 'Tarih') }}</label>
<input class="form-control" id="date" name="date" required="" type="date"/>
</div>
</div>
<div class="modal-footer">
<button class="btn btn-secondary" data-bs-dismiss="modal" type="button">{{ lang('btn_cancel', 'İptal') }}</button>
<button class="btn btn-primary" type="submit">{{ lang('btn_save', 'Kaydet') }}</button>
</div>
</form>
</div>
</div>
</div>

{% endblock %}
