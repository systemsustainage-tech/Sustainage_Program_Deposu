{% extends "base.html" %}

{% block title %}Rate Limiting{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
<div>
<h1 class="h2">Rate Limiting</h1>
<p class="text-muted mb-0">
            Giriş, API ve diğer işlemler için hız sınırları
        </p>
</div>
<div class="btn-toolbar mb-2 mb-md-0">

<button class="btn btn-sm btn-outline-secondary ms-2" onclick="history.back()"><i class="bi bi-arrow-left"></i> {{ lang('btn_back', 'Geri') }}</button></div>
</div>
<div class="row g-4 mb-4">
<div class="col-md-6">
<div class="card border-0 shadow-sm">
<div class="card-header">
<h5 class="mb-0">Global Limitler (Bilgilendirme)</h5>
</div>
<div class="card-body">
<ul class="mb-0">
<li>Giriş denemeleri: 5 / dakika</li>
<li>API istekleri: 100 / dakika</li>
<li>Rapor oluşturma: 10 / saat</li>
<li>Veri export: 5 / saat</li>
</ul>
</div>
</div>
</div>
<div class="col-md-6">
<div class="card border-0 shadow-sm">
<div class="card-header">
<h5 class="mb-0">Kural Ayarları</h5>
</div>
<div class="card-body">
<form method="post">
<input name="action" type="hidden" value="save_rules"/>
<div class="row g-3">
<div class="col-6">
<label class="form-label">Login Limit</label>
<input class="form-control" name="rl_login_limit" type="text" value="{{ current_rules.rl_login_limit }}"/>
</div>
<div class="col-6">
<label class="form-label">Login Pencere (sn)</label>
<input class="form-control" name="rl_login_window" type="text" value="{{ current_rules.rl_login_window }}"/>
</div>
<div class="col-6">
<label class="form-label">API Limit</label>
<input class="form-control" name="rl_api_limit" type="text" value="{{ current_rules.rl_api_limit }}"/>
</div>
<div class="col-6">
<label class="form-label">API Pencere (sn)</label>
<input class="form-control" name="rl_api_window" type="text" value="{{ current_rules.rl_api_window }}"/>
</div>
<div class="col-6">
<label class="form-label">Rapor Limit</label>
<input class="form-control" name="rl_report_limit" type="text" value="{{ current_rules.rl_report_limit }}"/>
</div>
<div class="col-6">
<label class="form-label">Rapor Pencere (sn)</label>
<input class="form-control" name="rl_report_window" type="text" value="{{ current_rules.rl_report_window }}"/>
</div>
<div class="col-6">
<label class="form-label">Export Limit</label>
<input class="form-control" name="rl_export_limit" type="text" value="{{ current_rules.rl_export_limit }}"/>
</div>
<div class="col-6">
<label class="form-label">Export Pencere (sn)</label>
<input class="form-control" name="rl_export_window" type="text" value="{{ current_rules.rl_export_window }}"/>
</div>
</div>
<button class="btn btn-success mt-3" type="submit">
<i class="bi bi-save"></i> Kaydet
                    </button>
</form>
</div>
</div>
</div>
</div>
<div class="card border-0 shadow-sm">
<div class="card-header d-flex justify-content-between align-items-center">
<h5 class="mb-0">Aktif Rate Limit Kayıtları (Son 1 Saat)</h5>
<form class="mb-0" method="post">
<input name="action" type="hidden" value="cleanup"/>
<button class="btn btn-sm btn-outline-danger" type="submit">
<i class="bi bi-broom"></i> Eski Kayıtları Temizle
            </button>
</form>
</div>
<div class="card-body p-0">
<div class="table-responsive">
<table class="table table-striped table-hover mb-0">
<thead class="table-light">
<tr>
<th>Kaynak</th>
<th>Tanımlayıcı</th>
<th>İstek Sayısı</th>
<th>Pencere Başlangıcı</th>
<th>Durum</th>
</tr>
</thead>
<tbody>
                    {% for r in rate_stats %}
                    <tr>
<td>{{ r.resource }}</td>
<td>{{ r.identifier }}</td>
<td>{{ r.count }}</td>
<td>{{ r.window_start }}</td>
<td>
                            {% if r.blocked %}
                            <span class="badge bg-danger">Bloklu</span>
                            {% else %}
                            <span class="badge bg-success">Aktif</span>
                            {% endif %}
                        </td>
</tr>
                    {% else %}
                    <tr>
<td class="text-center py-3 text-muted" colspan="5">Aktif kayıt bulunmuyor.</td>
</tr>
                    {% endfor %}
                </tbody>
</table>
</div>
</div>
</div>

{% endblock %}

